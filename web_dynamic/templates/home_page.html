<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookSwap Connect</title>
    <meta name="description" content="BookSwap Connect - Swap and share books easily.">
    <meta name="keywords" content="BookSwap, books, sharing, community">
    <link rel="stylesheet" href="/static/css/home_page.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body id="background-photo" class="overlay">
    <header>
        <div class="header-container">
            <nav class="navbar">
                <ul>
                    <li class="navbar__item navbar__item--active"><a href="#">Home</a></li>
                    <li class="navbar__item"><a href="#">My Books</a></li>
                    <li class="navbar__item"><a href="#">Profile</a></li>
                    <li class="navbar__item"><a href="#">Notifications</a></li>
                    <li class="navbar__item"><a href="/logout">Logout</a></li>
                </ul>
            </nav>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search for books..." aria-label="Search">
                <button id="search-button" type="button">Search</button>
            </div>
        </div>
    </header>
    <main>
        <h2 class="title-page">Welcome to BookSwap Connect</h2>
        <section class="add-book">
            <div class="add-book-button">
                <a href="/home/add_book">Add a new book</a>
            </div>
            <div class="view-swap-requests">
                <a href="/home/swap_requests">View Swap Requests</a>
            </div>
        </section>
        <section class="browser-available books">
            <div class="available-books">
                <a href="/home/available_books">browse available books</a>
            </div>
        </section>

        <section class="search-container">
            <div class="search-results">
                <div class="search-books-list" id="search-books"></div>
            </div>
        </section>
        <section class="recommended-container">
            <h2>Recommended Books</h2>
            <div class="recommended-books-list" id="recommended-books">
            </div>
        </section>
    </main>
    <footer>
        <div>
            <div>
                <a href="#">Terms of Service</a> | <a href="#">Privacy Policy</a>
            </div>
            <div class="footer-links">
                <h4>Follow us on:</h4>
                <a href="https://facebook.com">
                    <img src="/static/images/facebook_logo.png" alt="Facebook">
                </a>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('search-button').addEventListener('click', function() {
                const query = document.getElementById('search-input').value;
                if (query) {
                    searchBooks(query);
                }
            });
            addRecommendedBooks();
        });

        function searchBooks(query) {
            fetch(`/search?query=${query}`)
                .then(response => response.json())
                .then(data => {
                    displayResults(data);
                })
                .catch(error => console.error('Error:', error));
        }

        function displayResults(books) {
            const resultsContainer = document.querySelector('.search-results');
            resultsContainer.innerHTML = '';
            if (books.length === 0) {
                resultsContainer.innerHTML = `<h3>No books found. Please try another search term.</h3>`;

            }books.forEach(book => {
                const bookElement = document.createElement('div');
                bookElement.className = 'search-book';
                bookElement.innerHTML = `
                    <div class="cover">
                        <img src="/static/images/bookswap_front_page.png" alt="${book.title}">
                    </div>
                    <div class="details">
                        <h3>${book.title}</h3>
                        <p>Author: ${book.author}</p>
                        <button onclick="viewBookDetails('${book.id}')">View Details</button>
                        <a href="/home/request_swap?book_id=${book.id}" class="swap-button">Request Swap</a>
                    </div>
                `;
                resultsContainer.appendChild(bookElement);
            });
        }


        function addRecommendedBooks() {
            fetch('/recommended_books')
            .then(response => response.json())
            .then(data => {
                displayRecommendedBooks(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function displayRecommendedBooks(books) {
            const recommendedContainer = document.getElementById('recommended-books');
            recommendedContainer.innerHTML = '';
            books.forEach(book => {
                const bookElement = document.createElement('div');
                bookElement.className = 'recommended-book';
                bookElement.innerHTML = `
                    <div class="cover">
                        <img src="/static/images/bookswap_front_page.png" alt="${book.title}">
                    </div>
                    <div class="details">
                        <h3>${book.title}</h3>
                        <p>Author: ${book.author}</p>
                        <button onclick="viewBookDetails('${book.id}')">View Details</button>
                        <a href="/home/request_swap?book_id=${book.id}" class="swap-button">Request Swap</a>
                    </div>
                `;
                recommendedContainer.appendChild(bookElement);
            });
        }

        function viewBookDetails(bookId) {
            fetch(`/book/${bookId}`)
            .then(response => response.json())
            .then(book => {
                const detailsModal = document.createElement('div');
                detailsModal.className = 'book-details-modal';
                detailsModal.innerHTML = `
                    <div class="book-details">
                        <h3>${book.title}</h3>
                        <p>Author: ${book.author}</p>
                        <p>Genre: ${book.genre || 'Not specified'}</p>
                        <p>Condition: ${book.condition}</p>
                        <p>Description: ${book.description || 'No description available'}</p>
                        <button onclick="closeDetails()">Close</button>
                    </div>
                `;
                const clickedBook = document.querySelector(`[onclick="viewBookDetails('${bookId}')"]`);
                const rect = clickedBook.getBoundingClientRect();
                detailsModal.style.top = `${rect.bottom}px`;
                detailsModal.style.left = `${rect.left}px`;

                document.body.appendChild(detailsModal);
            })
            .catch(error => console.error('Error', error));
        }

        function closeDetails() {
            const detailsModal = document.querySelector('.book-details-modal');
            if (detailsModal) {
                detailsModal.remove();
            }
        }
    </script>
</body>
</html>
